## SQL简介：

### <font color=orange>一：我们可以把SQL语言按照功能划分为以下的4个部分</font>
1. **DDL**：英文叫做`Data Definition Language`，也就是数据定义语言，它用来定义我们的数据库对象，包括数据库、数据表和列。通过使用DDL，我们可以创建(CREATE)，删除(DELETE)和修改(UPDATE)数据库和表结构。
2. **DML**：英文叫做`Data Manipulation Language`，数据操作语言，我们用它操作和数据库相关的记录，比如增加、删除、修改数据表中的记录。
3. **DCL**：英文叫做`Data Control Language`，数据控制语言，我们用它来定义访问权限和安全级别。
4. **DQL**：英文叫做`Data Query Language`，数据查询语言，我们用它查询想要的记录，它是SQL语言的重中之重。在实际的业务中，我们绝大多数情况下都是在和查询打交道，因此学会编写正确且高效的查询语句，是学习的重点。

### <font color=orange>二：实体-关系图有什么用呢？</font>
它是我们用来描述现实世界的概念模型，在这个模型中有3个要素：实体、属性、关系。

实体就是我们要管理的对象，属性是标识每个实体的属性，关系则是对象之间的关系。比如我们创建了“英雄”这个实体，那么它下面的属性包括了姓名、职业、最大生命值、初始生命值、最大魔法值、初始魔法值和攻击范围等。同时，我们还有“用户”这个实体，它下面的属性包括用户ID、登录名、密码、性别和头像等。

“英雄”和“用户”这两个实体之间就是`多对多的关系`，也就是说一个英雄可以从属多个用户，而一个用户也可以拥有多个英雄。

除了多对多之外，也有`一对一`和`一对多`的关系。

### <font color=orange>三：关于SQL大小写的问题</font>
1. 表名、表别名、字段名、字段别名等都小写
2. SQL保留字、函数名、绑定变量等都大写

比如下面这个SQL语句：
```
SELECT name, hp_max FROM heros WHERE role_main = '战士';
```

可以看到SELECT、FROM、WHERE这些常用的SQL保留字都采用了大写，而name、hp_max、role_main这些字段名，表名都采用了小写。此外在数据表的字段名推荐采用下划线命名，比如role_main这种。

### <font color=orange>四：DB、DBS和DBMS的区别是什么？</font>
1. DBMS的英文全称是`DataBase Management System`，数据库管理系统，世界上它可以对多个数据库进行管理，所以可以理解为DBMS = 多个数据库（DB）+ 管理程序。
2. DB的英文是`DataBase`，也就是数据库。数据库是存储数据的集合，可以理解为多个数据表。
3. DBS的英文是`DataBase System`，数据库系统。它是更大的概念，包括了数据库、数据库管理系统以及数据库管理人员DBA。

这里需要主注意的是，虽然我们有时候把Oracle、MySQL等称之为数据库，但确切的讲，它们应该是数据管理系统，即DBMS。

### <font color=orange>五：Oracle中的SQL是如何执行的？</font>
我们先来看SQL在Oracle中的执行过程：

![](https://ae01.alicdn.com/kf/Ha30ae09ce8ff4d07841a5cc2d98f2d9am.png)

从上面这张图中可以看出，SQL语句在Oracle中经历了以下的几个步骤：
1. **语法检查**：检查SQL拼写是否正确，如果不正确，Oracle会报语法错误
2. **语义检查**：检查SQL中的访问对象是否存在。比如我们在写SELECT语句的时候，列名写错了，系统就会提示错误。语法检查和语义检查的作用是保证SQL语句没有错误
3. **权限检查**：看用户是否具备访问该数据的权限
4. **共享池检查**：共享池（Shared Pool）是一块内存池，最主要的作用是缓存SQL语句和该语句的执行计划。Oracle通过检查共享池是否存在SQL语句的执行计划，来判断进行软解析，还是硬解析。那软解析和硬解析又该怎么理解呢？
<br/>在共享池中，Oracle首先对SQL语句进行Hash运算，然后根据Hash值在库缓存（Library Cache）中查找，如果存在SQL语句的执行计划，就直接拿来执行，直接进入“执行器”的环节，这就是软解析。
<br/>如果没有找到SQL语句和执行计划，Oracle就需要解析树进行解析，生成执行计划，进入“优化器”这个步骤，这就是硬解析。
5. **优化器**：优化器中就是要进行硬解析，也就是决定怎么做，比如创建解析树，生成执行计划
6. **执行器**：当有了解析树和执行计划之后，就知道了SQL该怎么被执行，这样就可以在执行器中执行语句了。

### <font color=orange>六：Oracle中的SQL是如何执行的？</font>
MySQL是典型的C/S架构，即Client/Server架构，服务端程序使用的mysqld。整体的MySQL流程如下图所示：

![](https://ae01.alicdn.com/kf/H46bdf2d3c3af48aaae5c1b005ff4f4fer.png)

1. **连接层**：客户端和服务器端建立连接，客户端发送SQL至服务器端
2. **SQL层**：对SQL语句进行查询处理
3. **存储引擎层**：与数据库文件打交道，负责数据的存储和读取

其中SQL层与数据库文件的存储方式无关，我们来看下SQL层的结构：
![](https://ae01.alicdn.com/kf/H08dfd4385e3d4e5bbaf825d888d35258z.jpg)

1. **查询缓存**：Server如果在查询缓存中发现了这条SQL语句，就会直接将结果返回给客户端；如果没有，就进入到解析器阶段。需要说明的是，因为查询缓存往往效率不高，所以在MySQL8.0之后就抛弃了这个功能
2. **解析器**：在解析器中对SQL语句进行语法分析、语义分析
3. **优化器**：在优化器中会确定SQL语句的执行路径，比如是根据全表检索，还是根据索引来检索等
4. **执行器**：在执行之前需要判断该用户是否具备权限，如果具备权限就执行SQL查询并返回结果。在MySQL8.0以下的版本，如果设置了查询缓存，这时会将查询结果进行缓存。

MySQL允许开发人员设置自己的存储引擎，下面是一些常见的存储引擎：
1. **InnoDB存储引擎**：它是MySQL5.5版本之后默认的存储引擎，最大的特点是支持事务、行级锁定、外键约束等
2. **MyISAM存储引擎**：在MySQL5.5版本之前是默认的存储引擎，不支持事务，也不支持外键，最大的特点是速度快，占用资源少
3. **Memory存储引擎**：使用系统内存作为存储介质，以便得到更快的响应速度。不过如果mysqId进程崩溃，则会导致所有的数据丢失，因此我们只有当数据是临时的情况下才使用Memory存储引擎
4. **NDB存储引擎**：也叫做NDB Cluster存储引擎，主要用于MySQL Cluster分布式集群环境，类似于Oracle的RAC集群
5. **Archive存储引擎**：它有很好的压缩机制，用于文件归档，在请求写入时会进行压缩，所以也经常用来做仓库。

需要注意的是，数据库的设计在于表的设计，而在MySQL中每个表的设计都可以采用不同的存储引擎，我们可以根据实际的数据处理需要来选择存储引擎，这也是MySQL的强大之处。

### <font color=orange>六：如何在MySQL中对一条SQL语句的执行时间进行分析？</font>
首先我们需要看下profiling是否开启，开启它可以让MySQL收集在SQL执行时所使用的资源情况，命令如下：
```
mysql> select @@profiling;

// profiling=0 代表关闭
// 我们需要把profiling打开，即设置为1：
mysql> set profiling=1;

// 然后我们执行一个SQL查询（可以执行任何一个SQL查询）:
mysql> select * from blog.blog_tag;

// 获取上一次查询的执行时间，可以使用：
mysql> show profile;
```
![](https://ae01.alicdn.com/kf/H08dfd4385e3d4e5bbaf825d888d35258z.jpg)

也可以查询指定的Query ID，比如：
```
mysql> SHOW PROFILE for query 2;
```

在8.0版本之后，MySQL不再支持缓存查询，一旦数据表有更新，缓存都将清空，因此只有数据表是静态的时候，或者数据表很少发生变化时，使用缓存查询才有价值，否则如果数据表经常更新，反而增加了SQL的查询时间。

可以使用select version()来查看MySQL的版本情况。
```
mysql> SELECT version();
```
