## 基础内容

### 一：主要内容
+ 流水线的两种语法类型
+ 流水线的运行系统
+ 流水线的基本结构
+ Jenkins为流水线开发和运行提供的支持环境（以及相关工具）

#### 1. 脚本式流水线和声明式流水线
```
// 脚本式流水线
node ('worker_node1') {
    stage('Source') {   // 获取代码
        // 从Git仓库中获取代码
        git 'git@diyvb2://home/git/repositories/workshop.git'
    }
    stage('Compile') { // 编译和单元测试
        // 运行Gradle进行编译和单元测试
        sh "gradle clean compileJava test"
    }
}
// 声明式语法
pipeline {
    agent {label 'worker_node1'}
    stages {
        stage ('Source') {  // 获取代码
            steps {
                // 从Git仓库中获取代码
                git 'git@diyvb2://home/git/repositories/workshop.git'
            }
        }
        stage ('Compile') { // 编译和单元测试
            steps {
                // 运行Gradle进行编译和单元测试
                sh "gradle clean compileJava test"
            }
        }
    }
}
```
#### 2. 系统（system）：主节点（master）、节点（node）、代理节点（agent）和执行器（executor）
+ 主节点
  - 不推荐在主节点上执行高负载任务，任何需要大量处理的任务都应该在主节点之外的系统上运行
  - 凡是在主节点上执行的任务，都有权限访问所有的数据、配置和操作，这会构成潜在的安全风险
  - 在主节点上不应执行任何包含潜在阻塞的操作，因为主节点需要持续响应和管理各类操作过程
+ 节点
  - 包括主节点和代理节点
  - 节点也可以是一个容器
+ 代理节点
  - 在早先的版本中，`代理节点`被`从节点（slave）`，其代表了所有非主节点
  - 在脚本式流水线中，“节点”特指一个运行代理节点；在声明式流水线中，其指代一个特定的代理节点来分配节点
+ 执行器
  - 执行器只是节点/代理节点用于执行任务的一个插槽
  - 一个节点可以有任意多个执行器。执行器的数量定义了该节点可以执行的并发任务数量
  - 当主节点将任务分配给特定节点时，该节点上必须有可用的执行器插槽来立即执行该任务，否则该任务出于等待状态，直到一个执行器变为可用

#### 3. 运行一条流水线
+ 流水线语法中git语法的相关设置
    ![](https://ae01.alicdn.com/kf/Hf9011ae9201545bba2086ab383a7c4bf0.png)
    - 将poll选项设置为false，意味着源码控制仓库中的变更将无法自动检测和重新构建。否则。如果轮询功能打开，在第一次运行完成之后，源码控制仓库中的变化将被自动检测，并触发另一次任务的执行。
    - 将changelog选项设置为false，意味着Jenkins将不会自动获取变更记录，也不会在任务输出的Changes部分中显示。这么做唯一的好处在于，它可以减轻对版本控制系统的压力。
+ 运行时状态方块的颜色说明【有些不明确】
    - 蓝色表示尚未运行
    - 黄色表示正在运行
    - 绿色表示运行成功
    - 红色表示运行失败
+ 阶段方块说明
    - 每次构建时，Jenkins都会为流水线中的每个阶段创建一个新的方块。其中每一行代表了该项目的一次构建，每一列代表了流水线中的各个阶段。也就是说，每个方块都代表了一个特定阶段的一次执行结果。注意，我们可以在每一列的顶部看到对应stage步骤的参数（name），并且每个阶段的执行耗时也会在方块内部展示。
    - 方块颜色代码的含义

        | 颜色 | 含义 |
        |--|--|
        | 蓝色条纹 | 运行中 |
        | 白色 | 阶段尚未执行 |
        | 红色条纹 | 阶段执行失败 |
        | 绿色 | 阶段执行成功 |
        | 浅红色 | 阶段执行成功，但是下游的某个阶段出现失败 |
        【<font color=red>注意</font>】即便一个方块在某一时间被标记为绿色，如果下游阶段执行失败，它仍然有可能变为红色
