## Shell编程

### 一：认识shell
+ 什么是shell
+ Linux的启动过程
+ 怎样编写一个shell脚本
+ shell脚本的执行方式
+ 内建命令和外部命令的区别

#### 1. 什么是Shell
+ Shell是命令解释器，用于解释用户对操作系统的操作
+ Shell 有很多种
    - cat /etc/shells
+ CentOS 7默认使用的Shell是bash

#### 2. Linux的启动过程
+ BIOS-MBR-BootLoader(grub)-kernel-systemd-系统初始化-shell
    - **BIOS**：输入BIOS或者开机按f2选择引导介质
    - **MDR**：
         ```
        // 如果选择的引导介质为硬盘，那么就会有一个MBR
        // Linux中一切皆文件，所以使用dd查看
        dd if=/dev/sda of=mbr.bin bs=542 count=1
        // bs：表示读多少字节
        // count：表示多少块

        // 查看
        hexdump -C mbr.bin | more
        // 如果最后几个字节，显示55 aa，那么就表示是可引导的，将权限交给grub
        ```
    - **grub**：
        ```
        // Linux用的是grub2.0，所以进入/boot/grub2目录
        cd /boot/grub2
        // 查看目录，grub.cfg是配置文件，可以用于选择内核
        ls
        // 查看系统的默认内核
        grub2-editenv list
        // 查看当前用户所使用的内核
        uname -r
        ```

#### 3.Shell脚本的格式
+ Shell脚本
    - UNIX的哲学：一条命令只做一件事
    - 为了组合命令和多次执行，使用脚本文件来保存需要执行的命令
    - 赋予该文件执行权限（chmod u+rx filename）
+ 标准的Shell脚本要包含哪些元素
    - Sha-Bang
    - 命令
    - "#"号开头的注释
    - chmod u+rx filename 可执行权限
    - 执行命令
        - `bash ./filename.sh`
        - `./filename.sh`
        - `source ./filename.sh`
        - `. filename.sh`
        ```
        # 声明脚本是使用什么解释的
        #!/bin/bash

        cd /var/
        ls
        pwd
        du -sh
        # 显示文件所占用的字节大小
        du -sh *
        ```

#### 4.脚本不同执行方式的影响
+ 执行方式：
    1. `bash ./filename.sh`
    2. `./filename.sh`
    3. `source ./filename.sh`
    4. `. filename.sh`
+ 不同的影响：
    + 第2种方式需要文件有可执行权限
    + 第1种方式和第2种方式不会改变当前的路径(例如，使用cd的时候)
    + 第3种方式和第4种会改变当前的路径(例如，使用cd的时候)
+ 内建命令和外部命令的区别：
    + 内建命令不需要创建子进程
    + 内建命令对当前Shell生效

#### 5.管道与重定向
+ 管道与管道符
    - 管道和信号一样，也是进程通信的方式之一
    - 匿名管道（管道符）是Shell编程经常用到的通信工具
    - 管道符是“|”，将前一个命令执行的结果传递给后面的命令
        + `ps | cat`
        + `echo 123 | ps`
+ 子进程与子shell
+ 重定向符号
    - 一个进程默认会打开标准输入、标准输出、错误输出三个文件描述符
    - 输入重定向符号 “<”
        - `read var < /path/to/a/file`
    - 输出重定向符号 “>” “>>” “2>” “&>”
        - `echo 123 > /path/to/a/file`
        - **>**：会把文件中的内容全部清空，然后再把内容输入进去
        - **>>**：文件中的内容保持不变，另起一行将内容追加到原有的内容之后
        - **2>**：错误重定向，如果当前命令出现错误则输入到文件中
        - **&>**：无论输出正确还是错误，都全部输入到文件中
    - 输入和输出重定向组合使用
        - `cat > /path/to/a/file << EOF`
        - `l am $USER`
        - `EOF`

#### 6.变量赋值
+ 变量
    - 变量的定义
    - 变量的赋值
    - 变量的引用
    - 变量的作用范围
    - 系统环境变量
    - 环境变量配置文件
+ 变量名的命名规则
    - 字母、数字、下划线
    - 不以数字开头
+ 为变量赋值的过程，称为变量替换【弱类型，不区分类型】
    - <font color=red>注意</font>：等号左右两边不可以有空格，不然会报错
    - 变量名 = 变量值 ---> `a=123`
    - 使用let为变量赋值 ---> ` let a=10+20`
    - 将命令赋值给变量  ---> `l=ls `
    - 将命令结果赋值给变量，使用$()或者``  
        - `let c=$(ls -l /etc)`
    - 变量值有空格等特殊字符可以包含在" "或' '中
+ 变量的引用
    - ${变量名} 称作对变量的引用
    - echo ${变量名} 查看变量的值
    - ${变量名} 在部分情况下可以省略为 $变量名
+ 变量的作用范围
+ 变量的导出
    - export
+ 变量的删除
    - unset
+ 系统环境变量
    - set和env命令
    - $? $$ $0
        - **$?**：查看上一条命令是否执行正确
        - **$$**：查看当前的进程PID
        - **$0**：查看当前的进程名称
    - $PATH
    - $PS1
+ 位置变量
    - $1 $2 ... $n
